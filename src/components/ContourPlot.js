import React, {useRef, useState, useEffect} from 'react'
import Plot from 'react-plotly.js'

const ContourPlot = ({min_x, max_x, min_y, max_y, min_z, max_z, formula, no_pixels=80}) => {


    const [width, setWidth] = useState(0)
    const [height, setHeight] = useState(0)
    const ref = useRef(null)

    // Compute width of this component based on parent properties
    useEffect(() => {
        setWidth(ref.current.offsetParent.clientWidth)
        setHeight(ref.current.offsetParent.clientHeight)
        })

    const increment_x = (max_x-min_x)/no_pixels
    const increment_y = (max_y-min_y)/no_pixels
    const x =  Array.apply(null, Array(no_pixels)).map(function (x, i) { return ( min_x + i * increment_x)})
    const y =  Array.apply(null, Array(no_pixels)).map(function (x, i) { return ( min_y + i * increment_y)})
    var z = Array.apply(null, Array(no_pixels)).map(function (x, i) { return (
        Array.apply(null, Array(no_pixels)).map(function (x, j) { return (formula(min_x + i * increment_x, min_y + j * increment_y))}))
    })

    const colorscale=[[0.000,'rgb(42,9,2)'],[0.004,'rgb(43,10,3)'],[0.008,'rgb(44,11,4)'],[0.012,'rgb(45,12,5)'],[0.016,'rgb(46,12,6)'],
                [0.020,'rgb(47,13,7)'],[0.024,'rgb(48,13,8)'],[0.027,'rgb(49,14,9)'],[0.031,'rgb(50,15,10)'],[0.035,'rgb(51,15,11)'],
                [0.039,'rgb(52,16,11)'],[0.043,'rgb(53,17,12)'],[0.047,'rgb(54,17,13)'],[0.051,'rgb(55,18,14)'],[0.055,'rgb(56,18,15)'],
                [0.059,'rgb(57,19,15)'],[0.063,'rgb(58,20,16)'],[0.067,'rgb(59,20,17)'],[0.071,'rgb(60,21,17)'],[0.075,'rgb(61,22,18)'],
                [0.078,'rgb(62,22,19)'],[0.082,'rgb(63,23,19)'],[0.086,'rgb(64,23,20)'],[0.090,'rgb(65,24,20)'],[0.094,'rgb(66,25,21)'],
                [0.098,'rgb(67,25,21)'],[0.102,'rgb(69,26,22)'],[0.106,'rgb(70,27,22)'],[0.110,'rgb(71,27,23)'],[0.114,'rgb(72,28,23)'],
                [0.118,'rgb(73,29,24)'],[0.122,'rgb(74,29,24)'],[0.125,'rgb(75,30,25)'],[0.129,'rgb(76,31,25)'],[0.133,'rgb(77,31,26)'],
                [0.137,'rgb(78,32,27)'],[0.141,'rgb(80,33,27)'],[0.145,'rgb(81,33,28)'],[0.149,'rgb(82,34,28)'],[0.153,'rgb(83,35,29)'],
                [0.157,'rgb(84,35,29)'],[0.161,'rgb(85,36,30)'],[0.165,'rgb(86,37,30)'],[0.169,'rgb(87,38,31)'],[0.173,'rgb(88,38,31)'],
                [0.176,'rgb(89,39,32)'],[0.180,'rgb(91,40,33)'],[0.184,'rgb(92,40,33)'],[0.188,'rgb(93,41,34)'],[0.192,'rgb(94,42,34)'],
                [0.196,'rgb(95,43,35)'],[0.200,'rgb(96,43,35)'],[0.204,'rgb(97,44,36)'],[0.208,'rgb(98,45,37)'],[0.212,'rgb(99,46,37)'],
                [0.216,'rgb(101,46,38)'],[0.220,'rgb(102,47,38)'],[0.224,'rgb(103,48,39)'],[0.227,'rgb(104,48,39)'],[0.231,'rgb(105,49,40)'],
                [0.235,'rgb(106,50,41)'],[0.239,'rgb(107,51,41)'],[0.243,'rgb(108,52,42)'],[0.247,'rgb(109,52,42)'],[0.251,'rgb(111,53,43)'],
                [0.255,'rgb(112,54,44)'],[0.259,'rgb(113,55,44)'],[0.263,'rgb(114,55,45)'],[0.267,'rgb(115,56,46)'],[0.271,'rgb(116,57,46)'],
                [0.275,'rgb(117,58,47)'],[0.278,'rgb(118,58,47)'],[0.282,'rgb(119,59,48)'],[0.286,'rgb(120,60,49)'],[0.290,'rgb(122,61,49)'],
                [0.294,'rgb(123,62,50)'],[0.298,'rgb(124,62,51)'],[0.302,'rgb(125,63,51)'],[0.306,'rgb(126,64,52)'],[0.310,'rgb(127,65,52)'],
                [0.314,'rgb(128,66,53)'],[0.318,'rgb(129,66,54)'],[0.322,'rgb(130,67,54)'],[0.325,'rgb(131,68,55)'],[0.329,'rgb(133,69,56)'],
                [0.333,'rgb(134,70,56)'],[0.337,'rgb(135,71,57)'],[0.341,'rgb(136,71,58)'],[0.345,'rgb(137,72,58)'],[0.349,'rgb(138,73,59)'],
                [0.353,'rgb(139,74,60)'],[0.357,'rgb(140,75,60)'],[0.361,'rgb(141,76,61)'],[0.365,'rgb(142,76,62)'],[0.369,'rgb(143,77,63)'],
                [0.373,'rgb(144,78,63)'],[0.376,'rgb(146,79,64)'],[0.380,'rgb(147,80,65)'],[0.384,'rgb(148,81,65)'],[0.388,'rgb(149,82,66)'],
                [0.392,'rgb(150,83,67)'],[0.396,'rgb(151,83,67)'],[0.400,'rgb(152,84,68)'],[0.404,'rgb(153,85,69)'],[0.408,'rgb(154,86,70)'],
                [0.412,'rgb(155,87,70)'],[0.416,'rgb(156,88,71)'],[0.420,'rgb(157,89,72)'],[0.424,'rgb(158,90,73)'],[0.427,'rgb(159,90,73)'],
                [0.431,'rgb(160,91,74)'],[0.435,'rgb(161,92,75)'],[0.439,'rgb(163,93,75)'],[0.443,'rgb(164,94,76)'],[0.447,'rgb(165,95,77)'],
                [0.451,'rgb(166,96,78)'],[0.455,'rgb(167,97,78)'],[0.459,'rgb(168,98,79)'],[0.463,'rgb(169,99,80)'],[0.467,'rgb(170,100,81)'],
                [0.471,'rgb(171,101,82)'],[0.475,'rgb(172,101,82)'],[0.478,'rgb(173,102,83)'],[0.482,'rgb(174,103,84)'],[0.486,'rgb(175,104,85)'],
                [0.490,'rgb(176,105,85)'],[0.494,'rgb(177,106,86)'],[0.498,'rgb(178,107,87)'],[0.502,'rgb(179,108,88)'],[0.506,'rgb(180,109,89)'],
                [0.510,'rgb(181,110,89)'],[0.514,'rgb(182,111,90)'],[0.518,'rgb(183,112,91)'],[0.522,'rgb(184,113,92)'],[0.525,'rgb(185,114,93)'],
                [0.529,'rgb(186,115,93)'],[0.533,'rgb(187,116,94)'],[0.537,'rgb(188,117,95)'],[0.541,'rgb(189,118,96)'],[0.545,'rgb(190,119,97)'],
                [0.549,'rgb(191,120,98)'],[0.553,'rgb(192,121,98)'],[0.557,'rgb(193,122,99)'],[0.561,'rgb(194,123,100)'],[0.565,'rgb(194,124,101)'],
                [0.569,'rgb(195,125,102)'],[0.573,'rgb(196,126,103)'],[0.576,'rgb(197,127,104)'],[0.580,'rgb(198,128,104)'],[0.584,'rgb(199,129,105)'],
                [0.588,'rgb(200,130,106)'],[0.592,'rgb(201,131,107)'],[0.596,'rgb(202,132,108)'],[0.600,'rgb(203,133,109)'],[0.604,'rgb(204,134,110)'],
                [0.608,'rgb(205,135,111)'],[0.612,'rgb(206,136,111)'],[0.616,'rgb(206,137,112)'],[0.620,'rgb(207,138,113)'],[0.624,'rgb(208,139,114)'],
                [0.627,'rgb(209,140,115)'],[0.631,'rgb(210,141,116)'],[0.635,'rgb(211,142,117)'],[0.639,'rgb(212,143,118)'],[0.643,'rgb(213,144,119)'],
                [0.647,'rgb(213,145,120)'],[0.651,'rgb(214,146,121)'],[0.655,'rgb(215,147,122)'],[0.659,'rgb(216,149,123)'],[0.663,'rgb(217,150,123)'],
                [0.667,'rgb(218,151,124)'],[0.671,'rgb(218,152,125)'],[0.675,'rgb(219,153,126)'],[0.678,'rgb(220,154,127)'],[0.682,'rgb(221,155,128)'],
                [0.686,'rgb(222,156,129)'],[0.690,'rgb(222,157,130)'],[0.694,'rgb(223,158,131)'],[0.698,'rgb(224,159,132)'],[0.702,'rgb(225,161,133)'],
                [0.706,'rgb(226,162,134)'],[0.710,'rgb(226,163,135)'],[0.714,'rgb(227,164,136)'],[0.718,'rgb(228,165,137)'],[0.722,'rgb(229,166,138)'],
                [0.725,'rgb(229,167,139)'],[0.729,'rgb(230,168,140)'],[0.733,'rgb(231,170,141)'],[0.737,'rgb(231,171,142)'],[0.741,'rgb(232,172,143)'],
                [0.745,'rgb(233,173,144)'],[0.749,'rgb(234,174,145)'],[0.753,'rgb(234,175,146)'],[0.757,'rgb(235,176,147)'],[0.761,'rgb(236,178,149)'],
                [0.765,'rgb(236,179,150)'],[0.769,'rgb(237,180,151)'],[0.773,'rgb(238,181,152)'],[0.776,'rgb(238,182,153)'],[0.780,'rgb(239,183,154)'],
                [0.784,'rgb(239,185,155)'],[0.788,'rgb(240,186,156)'],[0.792,'rgb(241,187,157)'],[0.796,'rgb(241,188,158)'],[0.800,'rgb(242,189,159)'],
                [0.804,'rgb(242,191,161)'],[0.808,'rgb(243,192,162)'],[0.812,'rgb(243,193,163)'],[0.816,'rgb(244,194,164)'],[0.820,'rgb(245,195,165)'],
                [0.824,'rgb(245,197,166)'],[0.827,'rgb(246,198,167)'],[0.831,'rgb(246,199,168)'],[0.835,'rgb(247,200,170)'],[0.839,'rgb(247,201,171)'],
                [0.843,'rgb(248,203,172)'],[0.847,'rgb(248,204,173)'],[0.851,'rgb(248,205,174)'],[0.855,'rgb(249,206,176)'],[0.859,'rgb(249,208,177)'],
                [0.863,'rgb(250,209,178)'],[0.867,'rgb(250,210,179)'],[0.871,'rgb(251,211,180)'],[0.875,'rgb(251,213,182)'],[0.878,'rgb(251,214,183)'],
                [0.882,'rgb(252,215,184)'],[0.886,'rgb(252,216,185)'],[0.890,'rgb(252,218,186)'],[0.894,'rgb(253,219,188)'],[0.898,'rgb(253,220,189)'],
                [0.902,'rgb(253,222,190)'],[0.906,'rgb(253,223,191)'],[0.910,'rgb(254,224,193)'],[0.914,'rgb(254,225,194)'],[0.918,'rgb(254,227,195)'],
                [0.922,'rgb(254,228,197)'],[0.925,'rgb(255,229,198)'],[0.929,'rgb(255,231,199)'],[0.933,'rgb(255,232,201)'],[0.937,'rgb(255,233,202)'],
                [0.941,'rgb(255,235,203)'],[0.945,'rgb(255,236,205)'],[0.949,'rgb(255,237,206)'],[0.953,'rgb(255,239,207)'],[0.957,'rgb(255,240,209)'],
                [0.961,'rgb(255,242,210)'],[0.965,'rgb(255,243,211)'],[0.969,'rgb(255,244,213)'],[0.973,'rgb(255,246,214)'],[0.976,'rgb(255,247,216)'],
                [0.980,'rgb(255,248,217)'],[0.984,'rgb(255,250,218)'],[0.988,'rgb(255,251,220)'],[0.992,'rgb(255,252,221)'],[0.996,'rgb(255,254,223)'],
                [1.000,'rgb(255,255,224)']]


    var xAxisTemplate = {
        showgrid: false,
        zeroline: false,
        showticklabels: false,
        ticks: ''
      };

      var yAxisTemplate = {
        showgrid: false,
        zeroline: false,
        showticklabels: false,
        ticks: ''
      };

      var zAxisTemplate={

      }

      var margin={
        t: 0,
        b: 0,
        l: 0,
        r: 0,
      }

    // var data = [ {
	// 	z: z,
	// 	x: x,
	// 	y: y,
	// 	type: 'heatmap',
    //     showscale: false,
    //     xref: 'container',
    //     zmin: min_z,
    //     zmax: max_z,
    //     colorscale: colorscale
    // }];

    var data = [ {
		z: z,
		x: x,
		y: y,
		type: 'contour',
        showscale: false,
        xref: 'container',
        zmin: min_z,
        zmax: max_z,
        colorscale: colorscale,
        contours: {coloring: 'heatmap'},
        hoverinfo: 'none',
        ncontours: 25,
        // line: {color: '51626bff'}
    }];


    var layout = {
        width: width, height: height,
        xaxis:xAxisTemplate,
        yaxis:yAxisTemplate,
        margin: margin,
    }


      return (
        <div className="contour-container" ref={ref}>
            {width> 10 && height > 10  && (
             <Plot data={data} layout={layout} />
            )}
        </div>
      )
    
}

export default ContourPlot